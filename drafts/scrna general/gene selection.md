## A quick note on gene selection for single cell RNA-seq

When initially exploring single-cell -omics datasets, people often begin by selecting highly variable genes. They then run PCA or ICA on all the genes. From there, they begin looking at plots and loadings, and the often feed the cell embeddings into further analysis (clustering, UMAP, tSNE). I do this a lot, and in my experience, it depends crucially on the first step: gene selection. Biologically, this should be obvious: the types of genes you begin with determine what phenomena are highlighted in your analysis. Single-cell RNA papers often contain analyses based on careful curation of genes -- there's an example in the appendix.

Why not use all genes? Because regular PCA may give untenably noisy results when all genes are used. In the language of statistics, PCA is *inconsistent* when the dimension grows with the sample size. The noise will never average out, and the estimates will suffer. In practical terms, I would expect this to happen when the numbers of genes and cells are comparable. I have so far been unable to understand the geometry behind these results, but if you'd like to learn more about them, here's one place you could start. 

> Johnstone, I. M., & Lu, A. Y. (2009). On consistency and sparsity for principal components analysis in high dimensions. Journal of the American Statistical Association, 104(486), 682-693.

One solution to this problem is to limit the number of genes. This prevents the noise from growing, and with enough cells, estimates can then stabilize. Screening by excess variance is a way to choose the genes most likely to contain useful signal. Intuitively, if a typical gene has variance proportional to its mean expression, but your sample contains a mix of definitive endoderm and embryonic stem cells, then endoderm and stem cell markers will be highly variable -- high or low, but not close to their averages. 

What if there are nuisance factors that are expected to cause coordinated variation in genes, but you don't want them to show up in your results? For instance, you might want to ignore sequencing depth or cell cycle variation. A typical workflow (as seen in [a Seurat tutorial](https://satijalab.org/seurat/v3.0/pbmc3k_tutorial.html), for example) might perform feature selection as usual, then removes unwanted variation using linear regression. Unfortunately, if unwanted variation still dominates during the feature selection step, this may miss important genes. I have written and tested some code for feature selection after regressing out unwanted variation; check it out [on the maehr lab github page]().

#### Just one example of careful gene selection

> La Manno, G., Gyllborg, D., Codeluppi, S., Nishimura, K., Salto, C., Zeisel, A., ... & Lönnerberg, P. (2016). Molecular diversity of midbrain development in mouse, human, and stem cells. Cell, 167(2), 566-580.

Genes are selected carefully for calculation of cross-species correlations...

> [A] naive correlation coefficient calculated over the full transcriptome was biased to assign high similarity because of confounding factors such as size or number of expressed genes. We therefore further filtered the feature space to reduce it to the genes that were expressed with some significant variation across the cell types. This was defined using the following filter: select genes that are (1) significantly expressed (according to the Bayesian condition described above) over baseline in at least one cell type in both species but (2) in less than 6 cell types in at least one of the species and (3) with a maximal expression that was bigger than 1.5 molecules per cell and the smaller than 0.25 in either species. 1405 genes passed this filter and were used for the calculation of the correlation coefficient.

... and also for use in a stem cell classifier.

> To train the model, the top 4500 most variable genes were chosen by CV-mean relation as above, and refined as follows: (1) To avoid learning cell culture specific features instead of ES features we discarded genes that had minimal variability in the whole hESC differentiation experiment when compared to the combined dataset (2) To eliminate genes whose variation is orthogonal to cell-types and produce a more general model the gene list was further reduced to half. We did this by choosing the top genes ranked by three heuristics for cell-type specificity (fold-increase, fold-increase∗fraction-positive, fold-increase∗ fraction-positive